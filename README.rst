Joan
====

Joan cleans up C source code generated by the SmallEiffel compiler version
-0.75 (and maybe also later versions). It replaces the cryptic mangled names
by more meaningful ones, reformats the indention, and removes distracting
comments.


Introduction
------------

The idea behind joan is of course stupid and sick:

As of 2001, SmallEiffel does not include native debugging and profiling
tools. In some cases, `print` is good enough. If not, many people debug the
generated C code instead.

Looking at the C source generated by SmallEiffel is not much fun. Naturally,
the code is terse in order to compile faster and use less disk space. Joan
cleans up this C code, making it easier to read. In particular,it:

* assigns more meaningful names to most routines and types that have a
  direct relation to the Eiffel source.
* reformats indention to outline the structure.
* removes all comments as the existing ones serve no discernible purpose.

To get most out of it, it helps to know how to implement exception handling,
garbage collection, and multiple inheritance. But even with only some basic C
knowledge, you should be able to step through Eiffel routines and read
profiler output.

If SmallEiffel has its own IDE and tools, joan will not be of much
use anymore, except for tracking down Eiffel compiler bugs.


Installation
------------

1. Get the `SmallEiffel <http://smarteiffel.loria.fr/>`_ [now SmartEiffel ]
   compiler.
2. Get `GNU indent <http://www.gnu.org/software/indent/>`_, which reformats
   C source code. You can get the source and compile it, but there are
   already binary archives for a lot of (even non-Unixoid) systems
   somewhere on the web. Just make sure it is in the search path. Don't read
   the manual, joan knows about the proper options.
3. Get `vahunz <http://www.roskakori.at/vahunz/>`_, which replaces names in
   C source code. Unless you're running AmigaOS, just download vahunz.zip,
   compile it as described, and copy vahunz to some place in your search
   path. Don't read the manual, joan knows about the proper options, and
   will create all dictionaries and support files automatically.
4. Get joan from <https://github.com/roskakori/joan>.
5. Compile joan using SmallEiffel::

     $ compile -boost -no_split joan

6. Copy joan to some place in your search path.

That's it.


Usage
-----

Joan operates on the C source code and ``*.id`` file SmallEiffel generates. All
of these must exist. It then simply replaces the "ugly" ``*.c`` by a one that
will be easier to read.

The general pattern of operation is:

1. Compile your Eiffel source using for example::

     $ compile -no_split my_class

   This generates my_class.c, my_class.h, and my_class.id It is important to
   have the option "-no_split" and not to have "-clean".
2. Use joan like::

     $ joan my_class

3. Manually recompile the C source code joan created, for example::

     $ gcc my_class.c -o my_class

   You can specify C compiler options for debugging, profiler, and coverage
   information at will.
4. Run my_class, using all your C debugging and profiling tools.


Tutorial
--------

If you just compiled joan as described in the installation section, there
still should be three files in your current directory: joan.c, joan.h, and
joan.id.

Take a look at joan.c - it is basically illegible.

Now run::

  $ joan joan

and watch.

If everything works out, you will have a new joan.c. Take a look at it, it
should be nicer (as far as C can be nice).


Copyright
---------

Copyright (C) 2001 Thomas Aglassinger

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.


Support
-------

If you have some questions about the meaning of a C excerpt, ask them in the
SmallEiffel mailing list. Search the archive because many of them have
already been answered. In particular, questions about profiling with C tools.

You can reach the author via e-mail:
Thomas Aglassinger <roskakori@users.sourceforge.net>.


Known Bugs and Limitations
--------------------------

* Indent displays loads of warnings like::

    Warning:old style assignment ambiguity in "=*". Assuming "= *"

  You can ignore them. It seems there is no command line option to turn them
  off. (Please let me know if you know better.)
* All temporary files are still left around.
* The manual needs some additions, especially the copyright stuff.
* Only works if "-no_split" is used, although technically it shouldn't be
  difficult to support SE's incremental C sources.
* Some command line options could be nice. Internally, they are there (see
  JOAN_OPTIONS_SINGLETON), but there's no parser.


History
-------

Version 1.1, 2001-04-19

* Added version number.
* Cleaned up documentation.

Version 1.0, 2001-04-17

* First, (somewhat) public release to get some feedback


About Joan
----------

This tool is named after the actress Joan Collins. The relation is that
Eiffel looks nice, but after the compile time ("natural aging") turns into
worn out and saggy C. After applying joan ("lots of make up"), it looks
somewhat better, but still not really attractive. This is somewhat similar
to Joan Collins [at the turn of the millenium] and other members of the
Hollywood cult of ethernal fake youth.

Anyway, here's a couple of links about Joan Collins I found interesting:

* http://www.imdb.com/name/nm0001058/ - Joan Collins at the Internet Movie
  Data Base.
* http://www.gonzo.org/fun/wayward.html - While not directly related this
  article explains why a lot of people end up on his (non-joan-collins-nude)
  site looking for "joan collins nude". Most interesting for me, people
  actually search for "joan collins fake nude". You never stop learning.
